import os, sys, glob, pickle
import numpy as np

import src.utils as u
import configuration as c

import matplotlib.pyplot as plt

# Matplotlib
plt.rcParams.update( c.rc_param )

def plot_Ith_for_V_timing_dependence(input_amp_th, p):
	
	Vth      = p['Vth']
	dist     = p['dist']
	dir_imgs = p['dir_imgs']
	dist_id  = p['dist_id']
	
	ctl     = p['stim_types'][1]
	sic_bac = p['stim_types'][2]
	Ith_ctl  = input_amp_th[ ctl ][0] # 'dend_only'
	Ith_targ = np.array(list(input_amp_th[ sic_bac ].values()))
	delays   = np.array(list(input_amp_th[ sic_bac ].keys()))
	
	
	x_lim = [np.min(delays)*1.1, np.max(delays)*1.1]
	y_lim = [-80, 80]
	fig = plt.figure(constrained_layout=True, figsize=(5.0, 3.0))
	ax = fig.add_subplot()
	ax.spines['right'].set_visible(False)
	ax.spines['top'].set_visible(False)
	ax.set_xlabel('T(start,Idend)- T(end,Isoma) (ms)')
	ax.set_ylabel('(Ith_targ - Ith_ctl)/Ith_ctl (%)')
	ax.set_xlim(x_lim)
	ax.set_ylim(y_lim)
	fig.suptitle( 'Distance from soma: {:.0f} um, Ith: {:.0f} pA (ctl)'.format(dist, Ith_ctl) )
	
	ax.plot(x_lim,[0, 0], 'k:')
	ax.plot( delays, (Ith_targ - Ith_ctl)/Ith_ctl * 100,
				'o-', markersize=5, color='k', markerfacecolor='k', markeredgecolor="k" )
	
	filename =   'dist_{}_Ith_for_V_timing_dependence'.format( dist_id )
	plt.savefig(os.path.join(dir_imgs, filename + '.pdf'))
	plt.savefig(os.path.join(dir_imgs, filename + '.png'), dpi=300)
	plt.show(block=False)
	plt.pause(2)
	plt.close()
	
